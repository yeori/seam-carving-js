!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.seamcarving=t():e.seamcarving=t()}(self,(function(){return(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.r(t),e.d(t,{SeamCarving:()=>v,default:()=>d,init:()=>g});var n=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.expression=t}return t=e,(n=[{key:"isClass",get:function(){return"."===this.expression.charAt(0)}},{key:"isId",get:function(){return"#"===this.expression.charAt(0)}},{key:"value",get:function(){return this.expression.substring(1)}},{key:"setAttribute",value:function(e){if(this.isId)e.setAttribute("id",this.value);else{if(!this.isClass)throw new Error("neither id nor class : [".concat(this.expression,"]"));e.classList.add(this.value)}}}])&&r(t.prototype,n),i&&r(t,i),e;var t,n,i}(),i=(new Set,function(e){return(e||"").split(" ").map((function(e){return e.trim()})).filter((function(e){return e.length>0}))}),a=function(e,t,r){var i=document.createElement(e);return t.forEach((function(e){new n(e).setAttribute(i)})),r&&r.appendChild(i),i};const o=function(e,t){return a("CANVAS",i(e),t)};function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var h=function(e,t,r){var n=4*e,i=4*t,a=r[n+0]-r[i+0],o=r[n+1]-r[i+1],s=r[n+2]-r[i+2];return a*a+o*o+s*s},f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=o(null,t);this.$canvas=r,this.$$={}}var t,r;return t=e,(r=[{key:"setImageSource",value:function(e){this.$$.imgSource=e;var t=this.$canvas,r=e.width,n=e.height;t.width=r,t.height=n;var i=t.getContext("2d");this.$$.ctx=i,this.$$.viewport={width:r,height:n},this.repaint()}},{key:"cutVSeam",value:function(){this.$$.vseam||this.resolveVerticalSeam();for(var e=this.$$,t=e.vseam,r=e.viewport,n=e.imageData.data,i=0;i<r.height;i++){var a=4*(this.width*i+t[i]),o=a+4,s=4*(this.width*i+r.width-1);n.copyWithin(a,o,s),n[s+0]=255,n[s+1]=0,n[s+2]=0,n[s+3]=255}r.width-=1,this.$$.vseam=null,this.energies=null,this.repaint()}},{key:"renderVerticalSeam",value:function(e){var t=this.$$,r=t.ctx,n=t.viewport;r.strokeStyle="#ff0000",r.beginPath(),r.moveTo(e[0],0);for(var i=1;i<n.height;i++)r.lineTo(e[i],i);r.stroke()}},{key:"repaint",value:function(){var e=this.$$,t=e.ctx,r=e.imgSource,n=e.imageData;t.clearRect(0,0,this.width,this.height),n||(t.drawImage(r.image,0,0),this.$$.imageData=t.getImageData(0,0,this.width,this.height)),t.putImageData(this.$$.imageData,0,0)}},{key:"resolveVerticalSeam",value:function(){this.energies||(this.energies=function(e,t,r,n){for(var i,a,o,s=e.data,u=[],c=0;c<t.height;c++){var f=new Array(t.width);if(u.push(f),0!==c&&c+1!==t.height)for(var l=0;l<t.width;l++)if(0===l||l+1===t.width)f[l]=1e3;else{i=(o=l+c*r)-r,a=o+r;var v=h(o-1,o+1,s),g=h(i,a,s);u[c][l]=parseInt(1e3*Math.sqrt(v+g))/1e3}else f.fill(1e3)}return u}(this.$$.imageData,this.$$.viewport,this.width,this.height));var e=this.$$.viewport,t=e.width,r=e.height,n=function(e,t,r){for(var n,i,a,o,s,c=[],h=u(e[0]),f=[],l=1;l<r;l++){f=u(e[l]);for(var v=new Array(t),g=0;g<t;g++){var d=(n=h,a=g,o=g+1,s=void 0,s=(i=g-1)<0?a:n[i]<n[a]?i:a,s=o===n.length||n[s]<=n[o]?s:o);v[g]=d,f[g]+=h[d]}c.push(v),h=f}var m=0;f.forEach((function(e,t){e<f[m]&&(m=t)}));for(var p=[m],y=c.length-1;y>=0;y--)m=c[y][m],p.push(m);return p.reverse()}(this.energies,t,r);this.$$.vseam=n,this.renderVerticalSeam(n)}},{key:"width",get:function(){return this.$$.imgSource.width}},{key:"height",get:function(){return this.$$.imgSource.height}}])&&s(t.prototype,r),e}();function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$$={},this.$$.$wrapper=t,this.canvas=new f(t)}var t,r;return t=e,(r=[{key:"render",value:function(e){var t=this;!function(e,t){var r=new Image;r.onload=function(){t(r)},r.src=window.URL.createObjectURL(e)}(e,(function(r){t.$$.imageSource={image:r,width:r.width,height:r.height,size:e.size},t.canvas.setImageSource(t.$$.imageSource)}))}},{key:"renderVSeam",value:function(){this.canvas.resolveVerticalSeam()}},{key:"cutVSeam",value:function(){this.canvas.cutVSeam()}}])&&l(t.prototype,r),e}(),g=function(e){return new v(e)};const d={SeamCarving:v};return t})()}));
//# sourceMappingURL=seamcarving.js.map