!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.seamcarving=t():e.seamcarving=t()}(self,(function(){return(()=>{"use strict";var e={d:(t,r)=>{for(var i in r)e.o(r,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:r[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function r(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}e.r(t),e.d(t,{SeamCarving:()=>v,default:()=>d,init:()=>g});var i=function(){function e(t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.expression=t}return t=e,(i=[{key:"isClass",get:function(){return"."===this.expression.charAt(0)}},{key:"isId",get:function(){return"#"===this.expression.charAt(0)}},{key:"value",get:function(){return this.expression.substring(1)}},{key:"setAttribute",value:function(e){if(this.isId)e.setAttribute("id",this.value);else{if(!this.isClass)throw new Error("neither id nor class : [".concat(this.expression,"]"));e.classList.add(this.value)}}}])&&r(t.prototype,i),n&&r(t,n),e;var t,i,n}(),n=(new Set,function(e){return(e||"").split(" ").map((function(e){return e.trim()})).filter((function(e){return e.length>0}))}),a=function(e,t,r){var n=document.createElement(e);return t.forEach((function(e){new i(e).setAttribute(n)})),r&&r.appendChild(n),n};const o=function(e,t){return a("CANVAS",n(e),t)};function s(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}var h=function(e,t,r){var i=4*e,n=4*t,a=r[i+0]-r[n+0],o=r[i+1]-r[n+1],s=r[i+2]-r[n+2];return a*a+o*o+s*s},f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=o(null,t);r.width=0,r.height=0,this.$canvas=r,this.$$={}}var t,r;return t=e,(r=[{key:"setImageSource",value:function(e){this.$$.imgSource=e;var t=this.$canvas,r=e.width,i=e.height;t.width=r,t.height=i,t.style.width="".concat(r,"px"),t.style.height="".concat(i,"px");var n=t.getContext("2d");this.$$.ctx=n,this.$$.viewport={width:r,height:i},this.repaint()}},{key:"cutVSeam",value:function(){this.$$.vseam||this.resolveVerticalSeam();for(var e=this.$$,t=e.vseam,r=e.viewport,i=e.imageData.data,n=0;n<r.height;n++){var a=4*(this.width*n+t[n]),o=a+4,s=4*(this.width*n+r.width-1);i.copyWithin(a,o,s),i[s+0]=255,i[s+1]=0,i[s+2]=0,i[s+3]=255}r.width-=1,this.$$.vseam=null,this.energies=null,this.repaint()}},{key:"renderVerticalSeam",value:function(e){var t=this.$$,r=t.ctx,i=t.viewport;r.strokeStyle="#ff0000",r.beginPath(),r.moveTo(e[0],0);for(var n=1;n<i.height;n++)r.lineTo(e[n],n);r.stroke()}},{key:"repaint",value:function(){var e=this.$$,t=e.ctx,r=e.imgSource,i=e.imageData;t.clearRect(0,0,this.width,this.height),i||(t.drawImage(r.image,0,0),this.$$.imageData=t.getImageData(0,0,this.width,this.height)),t.putImageData(this.$$.imageData,0,0)}},{key:"resolveVerticalSeam",value:function(){this.energies||(this.energies=function(e,t,r,i){for(var n,a,o,s=e.data,u=[],c=0;c<t.height;c++){var f=new Array(t.width);if(u.push(f),0!==c&&c+1!==t.height)for(var l=0;l<t.width;l++)if(0===l||l+1===t.width)f[l]=1e3;else{n=(o=l+c*r)-r,a=o+r;var v=h(o-1,o+1,s),g=h(n,a,s);u[c][l]=parseInt(1e3*Math.sqrt(v+g))/1e3}else f.fill(1e3)}return u}(this.$$.imageData,this.$$.viewport,this.width,this.height));var e=this.$$.viewport,t=e.width,r=e.height,i=function(e,t,r){for(var i,n,a,o,s,c=[],h=u(e[0]),f=[],l=1;l<r;l++){f=u(e[l]);for(var v=new Array(t),g=0;g<t;g++){var d=(i=h,a=g,o=g+1,s=void 0,s=(n=g-1)<0?a:i[n]<i[a]?n:a,s=o===i.length||i[s]<=i[o]?s:o);v[g]=d,f[g]+=h[d]}c.push(v),h=f}var m=0;f.forEach((function(e,t){e<f[m]&&(m=t)}));for(var p=[m],y=c.length-1;y>=0;y--)m=c[y][m],p.push(m);return p.reverse()}(this.energies,t,r);this.$$.vseam=i,this.renderVerticalSeam(i)}},{key:"width",get:function(){return this.$$.imgSource.width}},{key:"height",get:function(){return this.$$.imgSource.height}}])&&s(t.prototype,r),e}();function l(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var v=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$$={},this.$$.$wrapper=t,this.canvas=new f(t)}var t,r;return t=e,(r=[{key:"render",value:function(e){var t=this;!function(e,t){var r=new Image;r.onload=function(){t(r)},r.src=window.URL.createObjectURL(e)}(e,(function(r){t.$$.imageSource={image:r,width:r.width,height:r.height,size:e.size},t.canvas.setImageSource(t.$$.imageSource)}))}},{key:"renderVSeam",value:function(){this.canvas.resolveVerticalSeam()}},{key:"cutVSeam",value:function(){this.canvas.cutVSeam()}}])&&l(t.prototype,r),e}(),g=function(e){return new v(e)};const d={SeamCarving:v};return t})()}));
//# sourceMappingURL=seamcarving.js.map